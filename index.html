<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>MariateguiVis :: LaRed</title>
  <link href="css/styles.css" rel="stylesheet">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <style>
  #custom-handle {
    width: 8em;
    height: 3em;
    top: 10%;
    margin: 0;
    padding: 0;
    text-align: center;
    line-height: 1em;
    font-size: 1em;
    margin:0 50% 0 auto;
  }
  #slider {
    width:80%;
    margin-left:40px;
  }
  </style>
  <script src="./js/jquery.min.js" charset="utf-8"></script>
  <script src="./js/jquery.mousewheel.min.js" charset="utf-8"></script>
  <script src="./js/raphael.min.js" charset="utf-8"></script>
  <script src="./js/jquery.mapael.js" charset="utf-8"></script>
  <script src="./js/maps/world_countries.js" charset="utf-8"></script>
  <script src="./js/maps/peru.min.js" charset="utf-8"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <script src="./data/mariategui_lared.js" charset="utf-8"></script>
  <script type="text/javascript">

  // Get date from URL POST var:

  //var mydateY = "19240101_19241231";
  //var mydateX = "19250101_19251231";
  //var mydate_default = "19230101";
  //function getParameterByName(name) {
  //  return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
  //}

  // Getting plots from data/events.js
  function get_plots(map, mydate) {
    my = {};
    console.log("func. get_plots ( "+map+"|"+mydate+" )");
    $.each( events, function( key, value ) {
      //value["date"] = value["date"].toString().substr(0, value["date"].toString().length - 2);
      if (value["date"].length > 6) { value["date"] = parseInt(value["date"].toString().substr(0,6)); }
      if (mydate >= value["date"])  {
        my[value["name"]] = value["data"];
        console.log("# # # Accepted "+value["name"].toString()+": my="+mydate+" >= "+value["date"]);
      }
    });
    //console.log(my.toString());
    return my;
  }

  function get_plots_labels(map, mydate) {
    var my = [];
    console.log("F get_LABELS ( "+map+"|"+mydate+" )");
    $.each( events, function( key, value ) {
      //value["date"] = value["date"].toString().substr(0, value["date"].toString().length - 2);
      if (mydate >= value["date"])  {
        my.push(value["name"]);
        console.log("> > > Labels "+value["name"]+": my="+mydate+" >= "+value["date"]);
      }
    });
    return my;
  }

    $( function() {
      // Date dropdown selector

    });
  </script>

</head>

<!-- ############################################## -->
<!-- ############################################## -->
<!-- ############################################## -->

<body>
<div class="container">
    <div>
        <h1>Linking maps with slider interaction</h1>
                <p class="setDate" id="19240101">No PageLoad 1924 1231</p>
                <p class="setDate" id="19270101">No PageLoad 1927 1231</p>
    </div>

    <div class="" style="width:50%;padding:30px;margin: 0 auto;">
      <input id="setDate" class="score" type="number" min="1922" max="1928" value="1922">
    </div>

      <div class="mapcontainer mapcontainer_refresh div_map_left">
          <h2>Mapa del Per√∫</h2>
          <div class="map">
              <span>Alternative content for the map</span>
          </div>
      </div>

      <div class="mapcontainer2 mapcontainer_refresh div_map_right">
          <h2>Mapa Mundial</h2>
          <div class="map">
              <span>Alternative content for the map</span>
          </div>
      </div>
    </div>
  <div>OLD DATE:
    <div id="old_date"></div>
  </div>

<!----------------------------------------------->

<script>

$(function () {
    /*4
     * Override default option example
     * Here we override defaultOptions for all instance!
     * => We want to set the stroke color different for all of our instance
     */
    $.mapael.prototype.defaultOptions.map.defaultArea.attrs.stroke = "#c3c3c3";

    /*
     * Override method example
     * Here we override the setTooltip() method for all instance !
     * => We want that area having a tooltip appears as red when mouse over
     */
    // Save setTooltip function for future use
    var baseSetTooltip = $.mapael.prototype.setTooltip;
    $.mapael.prototype.setTooltip = function(elem){
        // Save ref to Mapael object in self
        var self = this;
        // Some special processing for "path" element having a tooltip
        if (elem.type === "path") {
            elem.attrsHover.fill = "#FF0000";
        }
        // Call base Mapael function
        baseSetTooltip.call(self, elem);
    };


///////////////////////////////////////
//// MAP1

    $(".mapcontainer").mapael({
        map: {
            name: "peru_regions",
            zoom: {
                enabled: true
            },
            defaultPlot: {
                attrs: {
                    fill: "#ff0000",
                    opacity: 10
                },
                text: {
                    attrs: {
                        fill: "#ff0000"
                    }
                    , attrsHover: {
                        fill: "#000"
                    }
                }
            },
            defaultArea: {
                attrs: {
                    fill: "#c3c3c3"
                },
                text: {
                    attrs: {
                        fill: "#ffffff"
                    }
                    , attrsHover: {
                        fill: "#000"
                    }
                }
            }
        },
        areas: {
            "lima": {
                text: {content: "Lima Region"},
                tooltip: {content: "region de Lima"},
                attrs: {opacity: 0.4}
            },
        },
        plots: {
            //get_plots(mariategui_plots, "peru")
        }
    });

///////////////////////////////////////////
//// MAP2

    var $mapcontainer2 = $(".mapcontainer2");
    $mapcontainer2.mapael({
        map: {
            name: "world_countries",
            zoom: {
                enabled: true,
                maxLevel: 20
            },
            defaultPlot: {
                attrs: {
                  fill: "#ff0000",
                  opacity: 1
                }
            },
            defaultArea: {
                attrs: {
                    fill: "#c3c3c3"
                },
                text: {
                    attrs: {
                        fill: "#ffffff"
                    }
                    , attrsHover: {
                        fill: "#000"
                    }
                }
            }
        },
        plots: {
            //get_plots(mariategui_plots, "world")
        }
    });

// >>>>>>>>>>>>>>>>>>>>>>>>
// UPDATING THE MAPS function
    $('#setDate').change(function (event) {
      var mydate = parseInt(event.target.value+"31");
      console.log("NEW mydate :"+mydate)

      // Get the old date
      var olddate = $("#old_date").html();
      console.log("OLD date :"+olddate)
      // Save new date:
      $("#old_date").html(mydate);

      // delete all plots ...
      if (olddate.length<1) {
        var deletedPlots = {};
      } else {
        var deletedPlots = get_plots_labels("peru", olddate);
      }
      console.log("deletedPlots: "+deletedPlots)

       // Update some plots and areas attributes ...
       // Not Usedm here

        // add some new plots ...
        var newPlots = //{
          get_plots("peru", mydate)
        //}

        $(".mapcontainer_refresh").trigger('update', [{
            deletePlotKeys: deletedPlots,
            newPlots: newPlots,
            animDuration: 3000
          }]);

        //////////////////////////////////////
        // circle animation:
        //$("circle").css("fill","blue");
        $( "circle" ).animate({
          r:20 ,
          opacity: 0.1
        }, 2000 );
        $( "circle" ).animate({
          r:3 ,
          opacity: 1
        }, 1500 );

  });
});


  </script>
</body>
</html>
