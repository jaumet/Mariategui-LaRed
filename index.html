<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>La Red Marátegui</title>
  <link href="css/styles.css" rel="stylesheet">
  <!-- libs -->
  <script src="./js/jquery.min.js" charset="utf-8"></script>
  <script src="./js/jquery.mousewheel.min.js" charset="utf-8"></script>
  <script src="./js/raphael.min.js" charset="utf-8"></script>
  <script src="./js/jquery.mapael.js" charset="utf-8"></script>
  <script src="./js/jquery-marquee.js" charset="utf-8"></script>
  <!--  maps -->
  <script src="./js/maps/world_countries.js" charset="utf-8"></script>
  <script src="./js/maps/peru.min.js" charset="utf-8"></script>
  <!-- data -->
  <script src="./data/mariategui_lared-300.js" charset="utf-8"></script>

  <script type="text/javascript">

  // Get date from URL POST var:

  //var mydateY = "19240101_19241231";
  //var mydateX = "19250101_19251231";
  //var mydate_default = "19230101";
  //function getParameterByName(name) {
  //  return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
  //}

  // Getting plots from data/events.js
  function get_plots(map, mydate) {
    my = {}; myMarquee = "";
    //console.log("func. get_plots ( "+map+"|"+mydate+" )");
    $.each( events, function( key, value ) {
      value["date"] = parseInt(value["date"].toString().substr(0,4));
      console.log(".... "+value["date"]+" ---->"+mydate);
      if (value["date"] == mydate)  {
        my[value["name"]] = value["data"];
        console.log("# # # Accepted "+value["name"].toString()+": my="+mydate+" >= "+value["date"]);
        myMarquee += value["name"].toString()+"<br />";
      }
    });
    myhtml = '<p>'+mydate+'</p><marquee id="marquee" behavior="scroll" direction="down" scrollamount="0.1" height="110" width="350">';
    $(".marquee").html(myhtml+myMarquee+"</p></marquee>");
    return my;
  }

  function get_plots_labels(map, mydate) {
    var my = [];
    console.log("F get_LABELS ( "+map+"|"+mydate+" )");
    $.each( events, function( key, value ) {
      if (mydate >= value["date"])  {
        my.push(value["name"]);
        console.log("> > > Labels "+value["name"]+": my="+mydate+" >= "+value["date"]);
      }
    });
    return my;
  };

  </script>

</head>

<!-- ############################################## -->
<!-- ############################################## -->
<!-- ############################################## -->

<body>
  <div class="container">
    <div>
        <h2>La Red Marátegui</h2>
    </div>

    <div class="" style="width:90%;padding:30px;margin: 0 auto;"> 
      <table class="barchart" width="950" height="70">
        <tr class="bars">
          <td class="b1">10<div style="height:10px;"></div></td>
          <td class="b2">70<div style="height:70px;"></div></td>
          <td class="b3">80<div style="height:80px;"></div></td>
          <td class="b4">50<div style="height:50px;"></div></td>
          <td class="b5">48<div style="height:48px;"></div></td>
          <td class="b6">45<div style="height:45px;"></div></td>
          <td class="b7">30<div style="height:30px;"></div></td>
          <td class="b8">67<div style="height:67px;"></div></td>
        </tr>
        <tr class="years">
          <td>1923</td>
          <td>1924</td>
          <td>1925</td>
          <td>1926</td>
          <td>1927</td>
          <td>1928</td>
          <td>1929</td>
          <td>1930</td>
        </tr>
      </table>
    </div>

    <div class="mapcontainer mapcontainer_refresh div_map_left">
        <h2>Mapa del Perú</h2>
        <div class="map">
            <span>Alternative content for the map</span>
        </div>
    </div>

    <div class="mapcontainer2 mapcontainer_refresh div_map_right">
        <h2>Mapa Mundial</h2>
        <div class="map">
            <span>Alternative content for the map</span>
        </div>
    </div>
  </div>

  <div class="marquee">
    <marquee id="marquee" behavior="scroll" direction="down" scrollamount="0.1" height="120" width="350">
      <p>START Lorem ipsum dolor sit amet END</p>
    </marquee>
  </div>

  <div id="old_date" class="old_date">
  </div>


<!-----------------------

ToDo:
- Three floor barchar diagrams: 
  > top: To al evennts = f( year )
  > middle 1: Regions 1 (Peru/oters) = f( year )
  > middel 2: Category = f(  )
  > bottom: Regions 2 (Peru/LatinoAm./ NorthAm./Europe/Africa-Asia-Oceania(in case there is any) 
  > 

  Data structure: CSV
  192totalNum, 192PeruNum, RestNum, RestoLatinoAm, NorthAm, EuropeNum, Asia-Africa-OceaniaNum, Cat1Num, Cat2Num, Cat3Num... 


------------------------>

<script>

$(function () {
    /*
     * Override default option example
     * Here we override defaultOptions for all instance!
     * => We want to set the stroke color different for all of our instance
     */
    $.mapael.prototype.defaultOptions.map.defaultArea.attrs.stroke = "#c3c3c3";

    /*
     * Override method example
     * Here we override the setTooltip() method for all instance !
     * => We want that area having a tooltip appears as red when mouse over
     */
    // Save setTooltip function for future use
    var baseSetTooltip = $.mapael.prototype.setTooltip;
    $.mapael.prototype.setTooltip = function(elem){
        // Save ref to Mapael object in self
        var self = this;
        // Some special processing for "path" element having a tooltip
        if (elem.type === "path") {
            elem.attrsHover.fill = "#FF0000";
        }
        // Call base Mapael function
        baseSetTooltip.call(self, elem);
    };


///////////////////////////////////////
//// MAP1

    $(".mapcontainer").mapael({
        map: {
            name: "peru_regions",
            zoom: {
                enabled: true
            },
            defaultPlot: {
                attrs: {
                    fill: "#ff0000",
                    opacity: 10
                },
                text: {
                    attrs: {
                        fill: "#ff0000"
                    }
                    , attrsHover: {
                        fill: "#000"
                    }
                }
            },
            defaultArea: {
                attrs: {
                    fill: "#c3c3c3"
                },
                text: {
                    attrs: {
                        fill: "#ffffff"
                    }
                    , attrsHover: {
                        fill: "#000"
                    }
                }
            }
        },
        areas: {
            "lima": {
                text: {content: "Lima Region"},
                tooltip: {content: "region de Lima"},
                attrs: {opacity: 0.4}
            },
        }
    });

///////////////////////////////////////////
//// MAP2

    var $mapcontainer2 = $(".mapcontainer2");
    $mapcontainer2.mapael({
        map: {
            name: "world_countries",
            zoom: {
                enabled: true,
                maxLevel: 20
            },
            defaultPlot: {
                attrs: {
                  fill: "#ff0000",
                  opacity: 1
                }
            },
            defaultArea: {
                attrs: {
                    fill: "#c3c3c3"
                },
                text: {
                    attrs: {
                        fill: "#ffffff"
                    }
                    , attrsHover: {
                        fill: "#000"
                    }
                }
            }
        }
    });

  function myMarquee() {
        // basic version is: $('div.demo marquee').marquee() - but we're doing some sexy extras
      $('marquee').marquee('pointer').mouseover(function () {
          $(this).trigger('stop');
      }).mouseout(function () {
          $(this).trigger('start');
      }).mousemove(function (event) {
          if ($(this).data('drag') == true) {
              this.scrollLeft = $(this).data('scrollX') + ($(this).data('x') - event.clientX);
          }
      }).mousedown(function (event) {
          $(this).data('drag', true).data('x', event.clientX).data('scrollX', this.scrollLeft);
      }).mouseup(function () {
          $(this).data('drag', false);
      })
    };

    // >>>>>>>>>>>>>>>>>>>>>>>>
    // UPDATING THE MAPS function
    $(".years td").on ("click", function () {
      var mydate = parseInt($(this).text());
      console.log("NEW mydate :"+mydate)

      //  toggle color on selected <td>
      $(".years td").removeClass('highlighted');
      $(this).addClass('highlighted');

      // Get the old date
      var olddate = $("#old_date").html();
      console.log("OLD date :"+olddate)
      // Save new date:
      $("#old_date").html(mydate);

      // delete all plots ...
      if (olddate.length<1) {
        var deletedPlots = {};
      } else {
        var deletedPlots = get_plots_labels("peru", olddate);
      }
      console.log("deletedPlots: "+deletedPlots)

       // Update some plots and areas attributes ...
       // Not Usedm here

        // add some new plots ...
        var newPlots = //{
          get_plots("peru", mydate)
        //}
    
    
        $(".mapcontainer_refresh").trigger('update', [{
            deletePlotKeys: deletedPlots,
            newPlots: newPlots,
            animDuration: 3000
          }]);
        myMarquee()
        
        //////////////////////////////////////
        // circle animation:
        //$("circle").css("fill","blue");
        $( "circle" ).animate({
          r:20 ,
          opacity: 0.1
        }, 2000 );
        $( "circle" ).animate({
          r:3 ,
          opacity: 1
        }, 1500 );

  });
});

/// 
  </script>
</body>
</html>
